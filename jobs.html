<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Téléporteur</title>
    <style>
        /* Center form vertically and horizontally */
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        
        /* Set element sizes */
        select {
            height: 2em;
            font-size: 1.2em;
        }
        button {
            height: 2em;
            font-size: 1.2em;
        }
        
        /* Flat design style */
        body {
            background-color: #fafafa;
            color: #333;
            font-family: sans-serif;
        }
        select, button {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 0;
            box-shadow: none;
            border-radius: 5px;
        }
        button:hover {
            cursor: pointer;
        }
        select:focus, button:focus {
            border-color: #B31B34;
            outline: none;
        }

        #errorMessage {
            color: red;
            font-size: 1.2em;
        }

        #confirmButton {
            background-color: #B31B34;
            color: white;
        }
    </style>      
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://play.workadventu.re/iframe_api.js"></script>
    <script>
        /// <reference path="../node_modules/@workadventure/iframe-api-typings/iframe_api.d.ts" />
        console.log('Jobs UI Website started successfully')

        $(document).ready(() => {
            const citiesArray = [
                "Alfortville (94)", // 0
                "Antony (92)", // 1
                "Bordeaux (33)", // 2
                "Brest (35)", // 3
                "Châlons-en-Champagne (51)", // 4
                "Fort de France (Martinique)", // 5
                "La Chapelle Saint-Mesmin (45)", // 6
                "La Chapelle-Saint-Luc (10)", // 7
                "La Garenne-Colombes (92)", // 8
                "Lyon (69)", // 9
                "Massy (91)", // 10
                "Niort (79)", // 11
                "Olivet (45)", // 12
                "Orléans (45)", // 13
                "Paris (75)", // 14
                "Poitiers (86)", // 15
                "Reims (51)", // 16
                "Rennes (35)", // 17
                "Rochefort (17)", // 18
                "Rouen (76)", // 19
                "Toulouse (31)", // 20
            ]

            const jobsArray = [
                "Actuaire", // 0
                "Administrateur(trice) SI referent(e)", // 1
                "Agent(e) comptable recouvrement", // 2
                "Analyste SI", // 3
                "Architecte .net", // 4
                "Assistant administratif", // 5
                "Assistant marketing", // 6
                "Assistant(e) commercial(e)", // 7
                "Business Developer", // 8
                "Business Developer assurances", // 9
                "Chargé d'affaires internes DSI", // 10
                "Chargé de comptes entreprises collectivités IARD", // 11
                "Chargé de relation client", // 12
                "Chargé de systèmes applicatifs", // 13
                "Chef de projet informatique", // 14
                "Chef(fe) de projet SI", // 15
                "Commercial(e) en assurance IARD Artisans", // 16
                "Conseiller(ère) de clientèle assurance", // 17
                "Développeur JAVA", // 18
                "Développeur front end confirmé", // 19
                "Directeur de marché établissements publics de santé", // 20
                "Développeur .net fullstack", // 21
                "Expert BI", // 22
                "Gestionnaire assurance", // 23
                "Gestionnaire assurance alternance", // 24
                "Gestionnaire de contrats d’assurance", // 25
                "Gestionnaire middle market", // 26
                "Gestionnaire sinistres", // 27
                "Gestionnaire technique immobilier", // 28
                "Juriste", // 29
                "Juriste Droit des Assurances", // 30
                "Juriste Hauts Risques Financiers", // 31
                "Juriste Responsabilité Civile et Décennale", // 32
                "Juriste en assurance indemnisation", // 33
                "Juriste généraliste", // 34
                "Manager équipe indemnisation RCM", // 35
                "Responsable d'agence", // 36
                "Responsable pôle administratif", // 37
                "Régleur de sinistre", // 38
                "Rédacteur prévoyance et santé collectives", // 39
                "Rédacteur réclamations contentieux recouvrement", // 40
                "Souscripteur Responsabilité Civile Médicale", // 41
                "Souscripteur confirmé IARD", // 42
                "Souscripteur en assurance construction", // 43
                "Souscripteur rc professionnelle et construction", // 44
            ]

            const companiesArray = [
                "RELYENS", // 0
                "SMA BTP", // 1
                "MUTUELLE DE POITIERS ASSURANCES", // 2
                "ASSURANCE MUTUELLE D'OUTRE-MER", // 3
                "MAF", // 4
                "MUTUELLE SAINT-CHRISTOPHE", // 5
                "L'ETOILE ASSURANCE", // 6
                "CMMA", // 7
                "SOLUCIA", // 8
                "CAMCA", // 9
                "LIBERTY SPECIALTY MARKETS", // 10
            ]

            // Data object with cities, jobs and companies
            var data = {
                "cities": [
                    {
                        "name": citiesArray[0],
                        "jobs": [
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[1],
                        "jobs": [
                            {
                                "name": jobsArray[2],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[25],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[2],
                        "jobs": [
                            {
                                "name": jobsArray[25],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[3],
                        "jobs": [
                            {
                                "name": jobsArray[7],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[4],
                        "jobs": [
                            {
                                "name": jobsArray[27],
                                "companies": [companiesArray[7]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[5],
                        "jobs": [
                            {
                                "name": jobsArray[14],
                                "companies": [companiesArray[3]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[6],
                        "jobs": [
                            {
                                "name": jobsArray[3],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[15],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[7],
                        "jobs": [
                            {
                                "name": jobsArray[36],
                                "companies": [companiesArray[7]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[8],
                        "jobs": [
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[9],
                        "jobs": [
                            {
                                "name": jobsArray[25],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[43],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[42],
                                "companies": [companiesArray[0]]
                            },
                            {
                                "name": jobsArray[41],
                                "companies": [companiesArray[0]]
                            },
                            {
                                "name": jobsArray[35],
                                "companies": [companiesArray[0]]
                            },
                            {
                                "name": jobsArray[30],
                                "companies": [companiesArray[0]]
                            },
                            {
                                "name": jobsArray[20],
                                "companies": [companiesArray[0]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[10],
                        "jobs": [
                            {
                                "name": jobsArray[25],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[11],
                        "jobs": [
                            {
                                "name": jobsArray[25],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[12],
                        "jobs": [
                            {
                                "name": jobsArray[39],
                                "companies": [companiesArray[0]]
                            },
                            {
                                "name": jobsArray[9],
                                "companies": [companiesArray[0]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[13],
                        "jobs": [
                            {
                                "name": jobsArray[1],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[14],
                        "jobs": [
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[43],
                                "companies": [companiesArray[1]]
                            },
                            {
                                "name": jobsArray[23],
                                "companies": [companiesArray[9]]
                            },
                            {
                                "name": jobsArray[6],
                                "companies": [companiesArray[9]]
                            },
                            {
                                "name": jobsArray[12],
                                "companies": [companiesArray[9]]
                            },
                            {
                                "name": jobsArray[13],
                                "companies": [companiesArray[9]]
                            },
                            {
                                "name": jobsArray[24],
                                "companies": [companiesArray[9]]
                            },
                            {
                                "name": jobsArray[10],
                                "companies": [companiesArray[9]]
                            },
                            {
                                "name": jobsArray[26],
                                "companies": [companiesArray[10]]
                            },
                            {
                                "name": jobsArray[31],
                                "companies": [companiesArray[4]]
                            },
                            {
                                "name": jobsArray[21],
                                "companies": [companiesArray[4]]
                            },
                            {
                                "name": jobsArray[4],
                                "companies": [companiesArray[4]]
                            },
                            {
                                "name": jobsArray[37],
                                "companies": [companiesArray[4]]
                            },
                            {
                                "name": jobsArray[22],
                                "companies": [companiesArray[4]]
                            },
                            {
                                "name": jobsArray[32],
                                "companies": [companiesArray[4]]
                            },
                            {
                                "name": jobsArray[0],
                                "companies": [companiesArray[5]]
                            },
                            {
                                "name": jobsArray[38],
                                "companies": [companiesArray[5]]
                            },
                            {
                                "name": jobsArray[29],
                                "companies": [companiesArray[5]]
                            },
                            {
                                "name": jobsArray[11],
                                "companies": [companiesArray[5]]
                            },
                            {
                                "name": jobsArray[34],
                                "companies": [companiesArray[8]]
                            },
                            {
                                "name": jobsArray[8],
                                "companies": [companiesArray[8]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[15],
                        "jobs": [
                            {
                                "name": jobsArray[19],
                                "companies": [companiesArray[2]]
                            },
                            {
                                "name": jobsArray[18],
                                "companies": [companiesArray[2]]
                            },
                            {
                                "name": jobsArray[28],
                                "companies": [companiesArray[2]]
                            },
                            {
                                "name": jobsArray[40],
                                "companies": [companiesArray[2]]
                            },
                            {
                                "name": jobsArray[44],
                                "companies": [companiesArray[2]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[16],
                        "jobs": [
                            {
                                "name": jobsArray[17],
                                "companies": [companiesArray[7]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[17],
                        "jobs": [
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[18],
                        "jobs": [
                            {
                                "name": jobsArray[16],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[19],
                        "jobs": [
                            {
                                "name": jobsArray[25],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                    {
                        "name": citiesArray[20],
                        "jobs": [
                            {
                                "name": jobsArray[33],
                                "companies": [companiesArray[1]]
                            },
                        ],
                    },
                ],
            }

            // Populate city selector
            var citySelect = $("#citySelect");
            citySelect.append("<option>Toutes les villes</option>")
            citiesArray.forEach((city) => {
                citySelect.append("<option>" + city + "</option>")
            })

            // Populate job selector
            var jobSelect = $("#jobSelect");
            var jobSelectLabel = $("#jobSelectLabel");
            jobSelect.append("<option>Tous les postes</option>")
            jobsArray.forEach((job) => {
                jobSelect.append("<option>" + job + "</option>")
            })

            // Populate company selector
            var companySelect = $("#companySelect")
            var companySelectLabel = $("#companySelectLabel")
            companySelect.append("<option>Choisissez une entreprise</option>")
            companiesArray.forEach((company) => {
                companySelect.append("<option>" + company + "</option>")
            })

            var selectedCityJobs = []
            var selectedJobCompanies = []

            // Filter job selector based on city selection
            citySelect.change(function() {
                var selectedCity = $(this).val()
                if (selectedCity === "Toutes les villes") {
                    selectedCityJobs = data.cities.map(city => city.jobs).flat()
                } else {
                    const selectedCityObj = data.cities.find(city => city.name === selectedCity)
                    selectedCityJobs = selectedCityObj && selectedCityObj.jobs ? selectedCityObj.jobs : undefined
                }

                if(selectedCityJobs) {
                    $("#errorMessage").hide()
                    jobSelect.empty()
                    jobSelect.append("<option>Tous les postes</option>")
                    selectedCityJobs.forEach((job) => {
                        jobSelect.append("<option>" + job.name + "</option>")
                    })
                    jobSelect.change()
                    jobSelectLabel.show()
                    jobSelect.show()
                    companySelectLabel.show()
                    companySelect.show()
                } else {
                    $("#errorMessage").text("Il n'exise pas de postes pour la ville sélectionnée.")
                    $("#errorMessage").show()
                    jobSelect.hide()
                    jobSelectLabel.hide()
                    companySelect.hide()
                    companySelectLabel.hide()
                }
            })

            // Filter company selector based on job selection
            jobSelect.change(function() {
                var selectedJob = $(this).val()
                if (selectedJob === "Tous les postes") {
                    let allSelectedCompanies = selectedCityJobs.map(job => job.companies).flat()
                    selectedJobCompanies = [...new Set(allSelectedCompanies)]
                } else {
                    const selectedJobObj = selectedCityJobs.find(job => job.name === selectedJob)
                    selectedJobCompanies = selectedJobObj && selectedJobObj.companies ? selectedJobObj.companies : undefined
                }

                if(selectedJobCompanies) {
                    $("#errorMessage").hide()
                    companySelect.empty()
                    selectedJobCompanies.forEach((company) => {
                        companySelect.append("<option>" + company + "</option>")
                    })
                    companySelect.change()
                    companySelectLabel.show()
                    companySelect.show()
                } else {
                    $("#errorMessage").text("Il n'exise pas d'entreprises pour le poste sélectionné.")
                    $("#errorMessage").show()
                    companySelect.hide()
                    companySelectLabel.hide()
                }
            })

            companySelect.change(function() {
                var selectedCompany = $(this).val()
                if (companiesArray.includes(selectedCompany)) {
                    $("#confirmButton").show()
                } else {
                    $("#confirmButton").hide()
                }
            })

            $("#confirmButton").click(function() {
                var selectedCompany = $("#companySelect").val()
                if (companiesArray.includes(selectedCompany)) {
                    const anchor = companiesArray.indexOf(selectedCompany)
                    WA.nav.goToRoom("#" + anchor)
                } else {
                    $("#errorMessage").text("Une erreur est survenue.")
                    $("#errorMessage").show()
                }
              
            })
        })
    </script>
</head>
<body>
    <div class="container">
        <form>
            <h2>Touvez le stand fait pour vous !</h2>

            <p id="errorMessage" style="display: none;"></p>

            <p>Pour quelle ville cherchez-vous un poste ?</p>
            <select id="citySelect"></select>

            <p id="jobSelectLabel" style="display: none;">Quel poste cherchez-vous ?</p>
            <select id="jobSelect" style="display: none;"></select>
        
            <p id="companySelectLabel">Quelle entreprise vous correspond ?</p>
            <select id="companySelect"></select>
        
            <button id="confirmButton" type="button" style="display: none;">Se téléporter</button>
        </form>
      </div>
</body>
</html>